package me.zeroX150.cornos.features.module.impl.exploit;

import me.zeroX150.cornos.etc.event.EventHelper;
import me.zeroX150.cornos.etc.event.EventType;
import me.zeroX150.cornos.etc.event.arg.PacketApplyEvent;
import me.zeroX150.cornos.etc.helper.STL;
import me.zeroX150.cornos.etc.render.Notification;
import me.zeroX150.cornos.features.module.Module;
import me.zeroX150.cornos.features.module.ModuleType;
import net.minecraft.network.packet.s2c.play.PlaySoundS2CPacket;
import net.minecraft.sound.SoundEvents;

public class LightningPlayerFinder extends Module {
    public LightningPlayerFinder() {
        super("SoundLogger", "Logs all interesting sound events", ModuleType.EXPLOIT);
        Module parent = this;
        EventHelper.BUS.registerEvent(EventType.ONPACKETHANDLE, event -> {
            if (!parent.isEnabled()) return;
            PacketApplyEvent pe = (PacketApplyEvent) event;
            if (pe.packet instanceof PlaySoundS2CPacket) {
                String name = null;
                int importance = 0;
                PlaySoundS2CPacket p = (PlaySoundS2CPacket) pe.packet;
                if (p.getSound() == SoundEvents.ENTITY_LIGHTNING_BOLT_THUNDER) {
                    name = "A lightning strike just hit";
                    importance = 6000;
                } else if (p.getSound() == SoundEvents.BLOCK_END_PORTAL_SPAWN) {
                    name = "An end portal was just created";
                    importance = 10000;
                }
                if (name != null) {
                    Notification.create("Sound logs", new String[]{name, p.getX() + ", " + p.getY() + ", " + p.getZ()},
                            importance);
                    STL.notifyUser(name + " at " + p.getX() + ", " + p.getY() + ", " + p.getZ());
                }
            }
        });
    }
}
